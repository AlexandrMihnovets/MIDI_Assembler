/*
 * MIDI_Assembler.asm
 * Created: 23.12.2021 15:17:51
 * Author: MikhnovetsA
 */ 


 .include "m328pdef.inc"										; На моём баяне микроконтроллер ATmega328p tqfp32. В этом файле все дефайны для него

 ; Start macro.inc========================================================================================================================================

 .include "macro.inc"

 ; End macro.inc

 ; RAM====================================================================================================================================================
					.DSEG										; Сегмент ОЗУ


 ; Flash==================================================================================================================================================
					.CSEG										; Сегмент программы

 .include "interrupts.inc"										; Подключаю файл, в котором описаны вектора прерываний

					; Инициализация Стека
 Reset:				ldi		r16, low(RAMEND)					; Записываю в регистры, отвечающие за дно Стека, адрес последней ячейки в оперативке.
					out		SPL, r16							; Так как адреса ячеек оперативки состоят из двух байт, а МК восьмибитный, использую 
					ldi		r16, high(RAMEND)					; директивы препроцессора low и high.
					out		SPH, r16							; Стек готов к работе.
 
 ; Start coreinit=========================================================================================================================================
 .include "flush.inc"											; Инициализация памяти (очистка от мусора)
 ; End coreiniy===========================================================================================================================================

 ; Internal hardware init=================================================================================================================================
 .include "timers_ini.inc"										; Подключаю файл с настройкой таймеров
 .include "port_ini.inc"										; Подключаю файл с настрйкой портов
 .include "uart_ini.inc"										; Подключаю файл с настройкой uart'а
 ; End internal hardware init=============================================================================================================================

 ; External hardware init=================================================================================================================================
 nop
 ; End external hardware init=============================================================================================================================

 ; Run====================================================================================================================================================
 nop
 ; End Run================================================================================================================================================

 ; Main===================================================================================================================================================
 Main:				nop
					nop
					nop
					nop
					jmp Main
 ; End Main===============================================================================================================================================

 ; Procedure==============================================================================================================================================

 ; End Procedure==========================================================================================================================================

 ; EEPROM=================================================================================================================================================
					.ESEG										; Сегмент энергонезависимой памяти


 ;=============================================================The End====================================================================================

